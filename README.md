# GridOverlay for tensileTest
## mvp-grid-overlay

Быстрый MVP-скрипт на Python/OpenCV для наложения **масштабной сетки 1 мм** на видео механических испытаний.
Калибруется по 4 углам образца, «распрямляет» перспективу в плоскость **22×22 мм**, поверх рисует сетку и сохраняет **ч/б-видео** (и при желании GIF). Калибровка сохраняется, чтобы не кликать повторно.

## Возможности

* Ручная калибровка: кликните **4 угла** (TL→TR→BR→BL) на первом кадре.
* Ортопроекция в плоскость образца 22×22 мм с выбранным масштабом (px/мм).
* Наложение полупрозрачной сетки с шагом **1 мм** и рамкой.
* Вывод: MP4 (H.264/`mp4v`) в градациях серого; опционально **GIF**.
* Сохранение калибровки в `*.json` рядом с видео.

## Установка

```bash
pip install opencv-python imageio
```
----------TEEEEEEEESSSSST-----------
```bash
pip install opencv-python, numpy, pandas
```
---------------------------------------
## Запуск

```bash
python mvp_grid_overlay.py -i Plumbum_24.09.2025_1.mp4 --scale 14 --preview
```

* Появится окно калибровки: кликните углы **TL→TR→BR→BL**, затем **Enter**.
* Результат: `Plumbum_24.09.2025_1_grid.mp4`.

GIF (осторожно: большой размер):

```bash
python mvp_grid_overlay.py -i Plumbum_24.09.2025_1.mp4 --scale 12 --gif --gif_fps 5
```

## Аргументы

* `-i/--input` — путь к исходному видео (mp4/avi и т.п.) **\[обязателен]**
* `-o/--output` — путь к выходному mp4 (по умолчанию `*_grid.mp4`)
* `--scale` — пикселей на 1 мм в ортопроекции (дефолт **12**; итоговый размер ≈ `22*scale`)
* `--thickness` — толщина линий сетки, px (дефолт **1**)
* `--preview` — показывать превью во время обработки
* `--gif` — дополнительно собрать GIF
* `--gif_fps` — FPS для GIF (дефолт **6**)

----------TEEEEEEEESSSSST-----------
```bash
python dic_mvp.py -i Plumbum_24.09.2025_1.mp4 --scale 14 --subset 9 --search 7 --grid_mm 1.0 --stride 2
```
---------------------------------------
## Аргументы
* `--scale` — px/мм (как в прежнем скрипте)
* `--subset` — радиус окна (9 ⇒ патч 19×19 px)
* `--search` — радиус поиска вокруг ожидаемой точки
* `--grid_mm` — шаг сетки DIC (мм)
* `--stride 2` — обрабатывать каждый 2-й кадр (ускоряет в 2 раза)

Результаты:
* `_dic.mp4` — видео с стрелочным полем перемещений и тепловой картой εyy.
* `_dic.csv` — средние деформации по кадру (можно смержить с логом машины по времени t_s)

## Как это работает

1. Считывается первый кадр, пользователь отмечает 4 угла образца.
2. По точкам считается гомография (`cv2.getPerspectiveTransform`) и выполняется `warpPerspective` в плоскость 22×22 мм при заданном `px/mm`.
3. Рендерится полупрозрачная 1-мм сетка и накладывается поверх.
4. Кадр переводится в градации серого и записывается в MP4; при `--gif` кадры даунсемплируются до нужного FPS и сохраняются в GIF.

## Советы по использованию

* Типичные значения `--scale`: **10–16** (баланс между деталями и скоростью/размером файла).
* Если много бликов/размытость — уменьшите `--scale` или используйте `--thickness 2`.
* Калибровка сохраняется в `video.json`; удалите файл, чтобы перекликать углы.

## Требования

* Python 3.8+
* OpenCV, imageio
  Работает на Windows/macOS/Linux.

## Лицензия

Ruslan Kiryanov, Institute of Nuclear Physics

